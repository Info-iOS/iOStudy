# GCD

---

## GCD란?

- 멀티 코더 시스템에서 동시성 실행을 제공하는 프로그램 언어입니다.
- 애플에서 제공하는 멀티스레딩을 제공하는 기술이면 macOS와 iOS의 비동기 작업을 할 때 사용합니다.
- CGD의 개념으로 동시성 프로그래밍을 하는 것이 Dispatch Queue 입니다.
- DispatchQueue에 작업을 정의해서 넣으면 운영체제가 적절한 스레드에 할당합니다.

## GCD를 쓰면 무엇이 좋을까?

- 앱의 성능과 반응성을 향상시킬 수 있습니다.
- GCD는 멀티코어 프로세서를 활용하여 성능을 극대화할 수 있습니다.

## GCD의 역사

- macOS 10.6 (Snow Leopard), iOS 4 처음 생기기 시작했습니다.

> 참고로 RxSwift는 iOS 7부터 사용할 수 있습니다.
> 

## GCD 뜯어보기

- GCD는 Queue로 이뤄져있습니다.
- GCD는 큐 작업 단위이고, 큐에 실행되고 추가 됩니다
- 큐를 사용하기 때문에 작업을 스케줄링하고 동시에 실행할 수 있습니다.

## **Dispatch Queue?**

> **Dispatch Queue는 두가지로 나누어집니다.**
> 
- Serial
    - 큐에 등록된 작업을 한 번에 하나씩 처리합니다.
    - 한 작업이 끝날 때까지 큐에 있는 다른 작업은 건드리지 않기 때문에 순서는 언제나 동일 합니다.
    - 요약: 작업을 순차적으로 처리합니다.
- Concurrent
    - 동시에 여러 작업을 수행할 수 있다.
    - 운영체제는 DispatchQueue 에서 꺼내온 현재 작업이 끝나지 않아도 다음 작업을 다른 스레드에 할당해 여러작업이 실행되도록 합니다.
    - 요약: 작업은 동시에 실행되지만 순서는 보장하지 않습니다.

### 3종류의 큐를 선택해서 사용할 수 있습니다.

- Main
    - 메인 스레드에서 작업을 보관하로 수행하는 큐입니다.
    - 큐에서 쌓이는 순서대로 실행합니다.
    - 메인 스레드에서 동작하기 떄문에 하나만 존재하며 serial인 특성을 가지고 있습니다.
    - Main Queue는 메인 스레드에서 실행되는 큐입니다.
    - UI 업데이트와 같은 작업을 할 때 메인 큐에서 실행합니다.
    - **`DispatchQueue.main`을 사용하여 메인 큐를 사용할 수 있습니다.**
- Global
    - Global Queue는 애플리케이션 전체에서 사용할 수 있는 큐입니다.
    - 메인이 아닌 다른 스레드에서 작업을 처리한다.
    - 여러 스레드로 분산 처리가 가능하다.
    - 작업이 완수되는 순서를 보장하지 않는다.
    - 백그라운드에서 비동기 작업을 실행하는 데 사용됩니다
    - • **`DispatchQueue.global()`** 메서드를 호출하여 기본적인 전역 큐에 액세스할 수 있습니다.

- Custom
    - 사용자가 어떤 특성의 큐로 생성할지 결정할 수 있게 해준다.
    - 기본적으로 serial 이지만 attributes인자로 concurrent로 바꿔줄 수 있다.
        - 때문에 작업 스케줄링 및 실행에 대한 제러를 더욱 세밀하게 조정할 수 있습니다.
        - 특정 작업에 대한 세부 제어가 필요한 경우 사용합니다.
    - **`DispatchQueue(label:)`** 메서드를 사용하여 사용자 정의 큐를 생성할 수 있으며, 라벨을 제공하여 큐를 식별할 수 있습니다.

### Serial 그게 뭔데?

- ~~먹는건가?~~
- 작업의 순차적으로 실행을 보장합니다.

### Concurrent 그게 뭔데?

- ~~먹는건가?~~
- 병렬 작업을 처리할 수 있도록 합니다.

## QoS(Quality of Service)?

- GCD에서 작업을 스케줄링하는데 사용되는 우선순의 개념
- 모든 각각의 작업에는 QoS 값이 할당되며, 이값은 작업이 실행되는 스레드나 큐에 대한 유선순위를 결정합니다.
- QoS는 앱의 성능과 응답성을 향상시킵니다.

### GCD에서는 4가지 QoS가 있습니다.

1. User-Interactiv
    1. 가장 높은 우선순위로, 사용자와의 상호작용에 사용됩니다.
    2. UI 업데이트 및 애니메이션 또는 이벤트 처리와 같은 작업들에 할당됩니다
    3. 즉각적인 응답이 필요할 때 가잔 높은 우선순위로 처리해야합니다.
2. User-Initiated
    1. 사용자가 시작한 작업을 위한 우선순위 입니다.
    2. 예시를 들으면 이해가 빠르기에 예시를 들겠습니다.
        1. 사용자가 이미지를 다운 받거나 파일을 업로드 할 때
        2. 사용자가 노래를 틀거나 노래를 추가할 때
    3. 작업들은 빠른 응답이 필요하지만 User-Interactive 보다는 낮은 우선순위 입니다.
3. Utility
    1. 백그라운드에서 실행되는 장기 싱행 작업을 위한 우선순위 입니다.
    2. 데이터베이스 또는 네트워크나 엄청 복잡한 연산등을 할 떄 사용합니다.
    3. 작업들은 시간이 오래 걸릴 수 있기 떄문에 우선순위가 낮습니다.
4. Background
    1. 가장 낮은 우선순위이며 느리고 비교적으로 중요하지 않은 우선 순위입니다.
    2. 데이터 동기화나 백업이 여기 포함됩니다.
    3. 이 작업들은 다른 작업보다 우선순위가 낮기에 느려질 수 있습니다.

## 아니~ 그래서 GCD 어케 쓰는건데?

- 동기적인 작업 실행 할 떄는 아래와 같이 사용합니다.

```swift
let queue = DispatchQueue(label: "동기")

queue.sync {
    print("동기 동기 동기 동기")
}
```

- 비동기적인 작업 실행 할 때는 아래와 같이 사용합니다.

```swift
let queue = DispatchQueue(label: "비동기")

queue.async {
    print("비동기 비동기 비동기 비동기")
}
```

- 지연시키고 싶다면 아래 코드를 참고하세요

```swift
let queue = DispatchQueue(label: "지연")

let delayInSeconds = 2.0

queue.asyncAfter(deadline: .now() + delayInSeconds) {
    print("2초 후 실행됨")
}
```

- 작업 업데이트를 하고 싶다면 아래를 참고해주세요

```swift
let queue = DispatchQueue(label: "")

let workItem = DispatchWorkItem {
    print("실행")
}

workItem.notify(queue: DispatchQueue.main) {
    print("완료")
}

queue.async(execute: workItem)
```